# üì± –ü–û–õ–ù–ê–Ø –ö–ê–†–¢–ê –ë–û–¢–ê "–ü–û–ü–£–¢–ß–ò–ö"

**–î–∞—Ç–∞ —Å–æ–∑–¥–∞–Ω–∏—è:** 21.01.2026 18:28

---

## üó∫Ô∏è –°–¢–†–£–ö–¢–£–†–ê –ù–ê–í–ò–ì–ê–¶–ò–ò

```
üè† –ì–õ–ê–í–ù–û–ï –ú–ï–ù–Æ (/start, main_menu)
‚îÇ
‚îú‚îÄ üîç –ù–∞–π—Ç–∏ –º–∞—Ä—à—Ä—É—Ç (search_route)
‚îÇ  ‚îú‚îÄ –í—Å–µ –º–∞—Ä—à—Ä—É—Ç—ã
‚îÇ  ‚îî‚îÄ –§–∏–ª—å—Ç—Ä–æ–≤–∞–Ω–Ω—ã–π –ø–æ–∏—Å–∫
‚îÇ     ‚îú‚îÄ –û—Ç–∫—É–¥–∞? (SearchStates.waiting_from)
‚îÇ     ‚îú‚îÄ –ö—É–¥–∞? (SearchStates.waiting_to)
‚îÇ     ‚îî‚îÄ –†–µ–∑—É–ª—å—Ç–∞—Ç—ã
‚îÇ
‚îú‚îÄ üöó –°–æ–∑–¥–∞—Ç—å –º–∞—Ä—à—Ä—É—Ç (create_route)
‚îÇ  ‚îú‚îÄ –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–æ—Ñ–∏–ª—è
‚îÇ  ‚îú‚îÄ –û—Ç–∫—É–¥–∞? (RouteCreate.waiting_for_from)
‚îÇ  ‚îú‚îÄ –ö—É–¥–∞? (RouteCreate.waiting_for_to)
‚îÇ  ‚îú‚îÄ –î–∞—Ç–∞ (RouteCreate.waiting_for_date)
‚îÇ  ‚îú‚îÄ –í—Ä–µ–º—è (RouteCreate.waiting_for_time) ‚è∞ –ë–ê–ì #24
‚îÇ  ‚îú‚îÄ –¶–µ–Ω–∞ (RouteCreate.waiting_for_price)
‚îÇ  ‚îú‚îÄ –ú–µ—Å—Ç–∞ (RouteCreate.waiting_for_seats)
‚îÇ  ‚îú‚îÄ –ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π (RouteCreate.waiting_for_comment)
‚îÇ  ‚îî‚îÄ –ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ (RouteCreate.confirm)
‚îÇ
‚îú‚îÄ üß≥ –ú–æ–∏ –ø–æ–µ–∑–¥–∫–∏ (my_trips)
‚îÇ  ‚îú‚îÄ –°–ø–∏—Å–æ–∫ –ø–æ–µ–∑–¥–æ–∫
‚îÇ  ‚îú‚îÄ –î–µ—Ç–∞–ª–∏ –ø–æ–µ–∑–¥–∫–∏
‚îÇ  ‚îî‚îÄ –û—Ç–º–µ–Ω–∞ –∑–∞—è–≤–∫–∏
‚îÇ
‚îú‚îÄ üó∫Ô∏è –ú–æ–∏ –º–∞—Ä—à—Ä—É—Ç—ã (my_routes)
‚îÇ  ‚îú‚îÄ –°–ø–∏—Å–æ–∫ –º–∞—Ä—à—Ä—É—Ç–æ–≤
‚îÇ  ‚îú‚îÄ –î–µ—Ç–∞–ª–∏ –º–∞—Ä—à—Ä—É—Ç–∞ (myroutes:details:ID)
‚îÇ  ‚îÇ  ‚îî‚îÄ –°–ø–∏—Å–æ–∫ –∑–∞—è–≤–æ–∫ –ø–∞—Å—Å–∞–∂–∏—Ä–æ–≤
‚îÇ  ‚îú‚îÄ –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ (myroutes:edit:ID) ‚úèÔ∏è –ë–ê–ì #18, #24
‚îÇ  ‚îÇ  ‚îú‚îÄ –ú–µ–Ω—é —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
‚îÇ  ‚îÇ  ‚îú‚îÄ –ò–∑–º–µ–Ω–µ–Ω–∏–µ –ø–æ–ª–µ–π
‚îÇ  ‚îÇ  ‚îú‚îÄ –§–∏–Ω–∞–ª—å–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –≤—Ä–µ–º–µ–Ω–∏ (–ë–ê–ì #24)
‚îÇ  ‚îÇ  ‚îî‚îÄ –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ + —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è (–ë–ê–ì #22, #27)
‚îÇ  ‚îú‚îÄ –û—Ç–º–µ–Ω–∞ –º–∞—Ä—à—Ä—É—Ç–∞ (myroutes:cancel:ID)
‚îÇ  ‚îî‚îÄ –í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ (myroutes:restore:ID)
‚îÇ
‚îî‚îÄ üë§ –ü—Ä–æ—Ñ–∏–ª—å (profile)
   ‚îú‚îÄ –ü—Ä–æ—Å–º–æ—Ç—Ä –ø—Ä–æ—Ñ–∏–ª—è
   ‚îú‚îÄ –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ (profile:edit)
   ‚îÇ  ‚îú‚îÄ –ò–º—è (EditProfileStates.waiting_for_name)
   ‚îÇ  ‚îú‚îÄ –û–ø–∏—Å–∞–Ω–∏–µ (EditProfileStates.waiting_for_bio)
   ‚îÇ  ‚îî‚îÄ –§–æ—Ç–æ (EditProfileStates.waiting_for_photo)
   ‚îî‚îÄ –£–¥–∞–ª–µ–Ω–∏–µ –∞–∫–∫–∞—É–Ω—Ç–∞ (profile:delete)
```

---

## üöó –°–û–ó–î–ê–ù–ò–ï –ú–ê–†–®–†–£–¢–ê

### –ü–æ—à–∞–≥–æ–≤—ã–π –º–∞—Å—Ç–µ—Ä (CreateRoute FSM)

**–§–∞–π–ª:** `handlers/route_create.py`

**–≠—Ç–∞–ø—ã:**

1. **–ü—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–æ—Ñ–∏–ª—è** - –µ—Å–ª–∏ –Ω–µ—Ç display_name ‚Üí –±–ª–æ–∫–∏—Ä–æ–≤–∫–∞
2. **–û—Ç–∫—É–¥–∞?** - –≤–≤–æ–¥ —Ç–µ–∫—Å—Ç–∞ (–º–∏–Ω–∏–º—É–º 2 —Å–∏–º–≤–æ–ª–∞)
3. **–ö—É–¥–∞?** - –≤–≤–æ–¥ —Ç–µ–∫—Å—Ç–∞ (–º–∏–Ω–∏–º—É–º 2 —Å–∏–º–≤–æ–ª–∞)
4. **–î–∞—Ç–∞** - –∫–∞–ª–µ–Ω–¥–∞—Ä—å (—Ç–æ–ª—å–∫–æ –±—É–¥—É—â–∏–µ –¥–∞—Ç—ã)
5. **–í—Ä–µ–º—è** - –≤–≤–æ–¥ —Å –≤–∞–ª–∏–¥–∞—Ü–∏–µ–π (–ë–ê–ì #24)
   - –§–æ—Ä–º–∞—Ç—ã: 1, 9, 15, 1430, 14:30
   - –í–∞–ª–∏–¥–∞—Ü–∏—è: –µ—Å–ª–∏ –¥–∞—Ç–∞ = —Å–µ–≥–æ–¥–Ω—è ‚Üí –≤—Ä–µ–º—è >= —Ç–µ–∫—É—â–µ–≥–æ
6. **–¶–µ–Ω–∞** - —Ü–µ–ª–æ–µ –ø–æ–ª–æ–∂–∏—Ç–µ–ª—å–Ω–æ–µ —á–∏—Å–ª–æ
7. **–ú–µ—Å—Ç–∞** - –º–∏–Ω–∏–º—É–º 1
8. **–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π** - –æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ
9. **–ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ** - –ø–æ–∫–∞–∑ –ø–æ–ª–Ω–æ–π –∫–∞—Ä—Ç–æ—á–∫–∏

**–ö–Ω–æ–ø–∫–∏ –Ω–∞–≤–∏–≥–∞—Ü–∏–∏:**
- `üîô –ù–∞–∑–∞–¥` - –Ω–∞ –∫–∞–∂–¥–æ–º —à–∞–≥–µ
- `‚ùå –û—Ç–º–µ–Ω–∏—Ç—å` - –Ω–∞ –∫–∞–∂–¥–æ–º —à–∞–≥–µ
- `‚úÖ –û–ø—É–±–ª–∏–∫–æ–≤–∞—Ç—å` - —Ñ–∏–Ω–∞–ª—å–Ω—ã–π —à–∞–≥

---

## ‚úèÔ∏è –†–ï–î–ê–ö–¢–ò–†–û–í–ê–ù–ò–ï –ú–ê–†–®–†–£–¢–ê

### –ú–µ—Ö–∞–Ω–∏–∑–º –∏–∑–º–µ–Ω–µ–Ω–∏–π (–ë–ê–ì #18, #24)

**–§–∞–π–ª:** `handlers/my_routes/edit_handler.py`

**–ö–ª—é—á–µ–≤—ã–µ –æ—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏:**

1. **–í—Ä–µ–º–µ–Ω–Ω–æ–µ —Ö—Ä–∞–Ω–µ–Ω–∏–µ** - –≤—Å–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è –≤ `changed_fields[]`
2. **–û—Ç–ª–æ–∂–µ–Ω–Ω–æ–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ** - –ø—Ä–∏–º–µ–Ω—è–µ—Ç—Å—è –ø—Ä–∏ "–ì–æ—Ç–æ–≤–æ"
3. **–í–∞–ª–∏–¥–∞—Ü–∏—è –≤—Ä–µ–º–µ–Ω–∏ (–ë–ê–ì #24)**:
   - –ü—Ä–∏ –≤–≤–æ–¥–µ –Ω–æ–≤–æ–≥–æ –≤—Ä–µ–º–µ–Ω–∏
   - –ü—Ä–∏ –Ω–∞–∂–∞—Ç–∏–∏ "–ì–æ—Ç–æ–≤–æ" (—Ñ–∏–Ω–∞–ª—å–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞)
4. **–£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –ø–∞—Å—Å–∞–∂–∏—Ä–∞–º (–ë–ê–ì #22, #27)**:
   - –§–æ—Ä–º–∞—Ç "–±—ã–ª–æ ‚Üí —Å—Ç–∞–ª–æ"
   - –ó–∞–¥–µ—Ä–∂–∫–∞ 0.3 —Å–µ–∫ –º–µ–∂–¥—É –æ—Ç–ø—Ä–∞–≤–∫–∞–º–∏
   - –¢–æ–ª—å–∫–æ –ø–∞—Å—Å–∞–∂–∏—Ä–∞–º —Å accepted –∑–∞—è–≤–∫–∞–º–∏

**–†–µ–¥–∞–∫—Ç–∏—Ä—É–µ–º—ã–µ –ø–æ–ª—è:**
- –û—Ç–∫—É–¥–∞
- –ö—É–¥–∞
- –î–∞—Ç–∞ (–∫–∞–ª–µ–Ω–¥–∞—Ä—å)
- –í—Ä–µ–º—è (–≤–∞–ª–∏–¥–∞—Ü–∏—è –ë–ê–ì #24)
- –¶–µ–Ω–∞
- –ú–µ—Å—Ç–∞
- –ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π (–∑–∞–º–µ–Ω–∏—Ç—å/–¥–æ–ø–∏—Å–∞—Ç—å/—É–¥–∞–ª–∏—Ç—å)

---

## üîç –ü–û–ò–°–ö –ú–ê–†–®–†–£–¢–û–í

### –î–≤–∞ —Ä–µ–∂–∏–º–∞ –ø–æ–∏—Å–∫–∞

**–§–∞–π–ª:** `handlers/routes_list/search_handler.py`

**–†–µ–∂–∏–º 1: –í—Å–µ –º–∞—Ä—à—Ä—É—Ç—ã** (search_route)
- –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç –í–°–ï –∞–∫—Ç–∏–≤–Ω—ã–µ –º–∞—Ä—à—Ä—É—Ç—ã
- –ò—Å–∫–ª—é—á–∞–µ—Ç —Å–≤–æ–∏ –º–∞—Ä—à—Ä—É—Ç—ã (–ë–ê–ì #2)
- –ö–∞—Ä—Ç–æ—á–∫–∏ —Å –ø—Ä–æ—Ñ–∏–ª–µ–º –≤–æ–¥–∏—Ç–µ–ª—è

**–†–µ–∂–∏–º 2: –§–∏–ª—å—Ç—Ä–æ–≤–∞–Ω–Ω—ã–π –ø–æ–∏—Å–∫** (search:start)
- –ë–ê–ì #3: –û–¥–Ω–æ –æ–∫–Ω–æ –¥–ª—è –≤—Å–µ—Ö –≤–æ–ø—Ä–æ—Å–æ–≤
- –®–∞–≥ 1: –û—Ç–∫—É–¥–∞?
- –®–∞–≥ 2: –ö—É–¥–∞? (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
- –ö–Ω–æ–ø–∫–∞ "–ü—Ä–∏–º–µ–Ω–∏—Ç—å" - –ø–æ–∫–∞–∑–∞—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã

**–ö–∞—Ä—Ç–æ—á–∫–∞ –º–∞—Ä—à—Ä—É—Ç–∞:**
- –ü—Ä–æ—Ñ–∏–ª—å –≤–æ–¥–∏—Ç–µ–ª—è (–∏–º—è, –±–∏–æ)
- –ú–∞—Ä—à—Ä—É—Ç (–æ—Ç–∫—É–¥–∞ ‚Üí –∫—É–¥–∞)
- –î–∞—Ç–∞ –∏ –≤—Ä–µ–º—è
- –¶–µ–Ω–∞ –∏ –º–µ—Å—Ç–∞
- –ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π (–µ—Å–ª–∏ –µ—Å—Ç—å)
- –°—Ç–∞—Ç—É—Å –∑–∞—è–≤–∫–∏ –ø–∞—Å—Å–∞–∂–∏—Ä–∞

**–ö–Ω–æ–ø–∫–∏ –∫–∞—Ä—Ç–æ—á–∫–∏:**
- üë§ –ü—Ä–æ—Ñ–∏–ª—å - –ø–æ–∫–∞–∑–∞—Ç—å –ø–æ–ª–Ω—ã–π –ø—Ä–æ—Ñ–∏–ª—å –≤–æ–¥–∏—Ç–µ–ª—è
- üëã –û—Ç–∫–ª–∏–∫–Ω—É—Ç—å—Å—è - –ø–æ–¥–∞—Ç—å –∑–∞—è–≤–∫—É
- üí¨ –ß–∞—Ç - –æ—Ç–∫—Ä—ã—Ç—å —á–∞—Ç —Å –≤–æ–¥–∏—Ç–µ–ª–µ–º (–µ—Å–ª–∏ –µ—Å—Ç—å username)

---

## üë§ –ü–†–û–§–ò–õ–¨

**–§–∞–π–ª:** `handlers/profile/view.py`

**–û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ:**
- –§–æ—Ç–æ (–µ—Å–ª–∏ –∑–∞–≥—Ä—É–∂–µ–Ω–æ)
- –ò–º—è (display_name)
- –û–ø–∏—Å–∞–Ω–∏–µ (bio)
- –†–µ–π—Ç–∏–Ω–≥ (–ø–æ–∫–∞ –Ω–µ—Ç –æ—Ç–∑—ã–≤–æ–≤)
- –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –º–∞—Ä—à—Ä—É—Ç–æ–≤

**–ë–ê–ì #15: –î–∏–Ω–∞–º–∏—á–µ—Å–∫–∞—è –∫–Ω–æ–ø–∫–∞**
- –ï—Å–ª–∏ –ø—Ä–æ—Ñ–∏–ª—å –Ω–µ –∑–∞–ø–æ–ª–Ω–µ–Ω ‚Üí "–°–æ–∑–¥–∞—Ç—å –ø—Ä–æ—Ñ–∏–ª—å"
- –ï—Å–ª–∏ –ø—Ä–æ—Ñ–∏–ª—å –∑–∞–ø–æ–ª–Ω–µ–Ω ‚Üí "–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –ø—Ä–æ—Ñ–∏–ª—å"

---

## üîÑ FSM –°–û–°–¢–û–Ø–ù–ò–Ø (State Machines)

### RouteCreate
```
waiting_for_from ‚Üí waiting_for_to ‚Üí waiting_for_date ‚Üí 
waiting_for_time ‚Üí waiting_for_price ‚Üí waiting_for_seats ‚Üí 
waiting_for_comment ‚Üí confirm
```

### EditRoute
```
waiting_for_value (—É–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ –¥–ª—è –≤—Å–µ—Ö –ø–æ–ª–µ–π)
```

### SearchStates
```
waiting_from ‚Üí waiting_to
```

### EditProfileStates
```
waiting_for_name / waiting_for_bio / waiting_for_photo
```

---

## ‚úÖ –ò–°–ü–†–ê–í–õ–ï–ù–ù–´–ï –ë–ê–ì–ò

### –ë–ê–ì #24 - –í–∞–ª–∏–¥–∞—Ü–∏—è –ø—Ä–æ—à–µ–¥—à–µ–≥–æ –≤—Ä–µ–º–µ–Ω–∏
**–§–∞–π–ª—ã:** `route_create.py`, `edit_handler.py`

**–ü—Ä–æ–±–ª–µ–º–∞:**
- –ú–æ–∂–Ω–æ –±—ã–ª–æ —É–∫–∞–∑–∞—Ç—å –ø—Ä–æ—à–µ–¥—à–µ–µ –≤—Ä–µ–º—è –Ω–∞ —Å–µ–≥–æ–¥–Ω—è

**–†–µ—à–µ–Ω–∏–µ:**
- –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–∏ –≤–≤–æ–¥–µ –≤—Ä–µ–º–µ–Ω–∏
- –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–π (—Ñ–∏–Ω–∞–ª—å–Ω–∞—è)
- –ö–æ—Ä—Ä–µ–∫—Ç–Ω–æ–µ —Å—Ä–∞–≤–Ω–µ–Ω–∏–µ —á–µ—Ä–µ–∑ `time()` –æ–±—ä–µ–∫—Ç—ã

### –ë–ê–ì #18 - –ò–∑–º–µ–Ω–µ–Ω–∏—è —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –º–≥–Ω–æ–≤–µ–Ω–Ω–æ
**–§–∞–π–ª:** `edit_handler.py`

**–ü—Ä–æ–±–ª–µ–º–∞:**
- –ò–∑–º–µ–Ω–µ–Ω–∏—è –ø—Ä–∏–º–µ–Ω—è–ª–∏—Å—å –≤ –ë–î —Å—Ä–∞–∑—É –ø—Ä–∏ –≤–≤–æ–¥–µ

**–†–µ—à–µ–Ω–∏–µ:**
- –í—Ä–µ–º–µ–Ω–Ω–æ–µ —Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤ `changed_fields[]`
- –ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ –≤—Å–µ—Ö –∏–∑–º–µ–Ω–µ–Ω–∏–π –æ–¥–Ω–∏–º –∑–∞–ø—Ä–æ—Å–æ–º –ø—Ä–∏ "–ì–æ—Ç–æ–≤–æ"

### –ë–ê–ì #3 - –ú–Ω–æ–∂–µ—Å—Ç–≤–æ –æ–∫–æ–Ω –ø—Ä–∏ –ø–æ–∏—Å–∫–µ
**–§–∞–π–ª:** `search_handler.py`

**–ü—Ä–æ–±–ª–µ–º–∞:**
- –°–æ–∑–¥–∞–≤–∞–ª–æ—Å—å –Ω–æ–≤–æ–µ –æ–∫–Ω–æ –Ω–∞ –∫–∞–∂–¥—ã–π –≤–æ–ø—Ä–æ—Å

**–†–µ—à–µ–Ω–∏–µ:**
- –û–¥–Ω–æ –æ–∫–Ω–æ —Ä–µ–¥–∞–∫—Ç–∏—Ä—É–µ—Ç—Å—è –Ω–∞ –∫–∞–∂–¥–æ–º —à–∞–≥–µ
- –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ `bot_message_id` –≤ state

---

